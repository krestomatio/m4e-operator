- name: k8s resources
  hosts: localhost
  gather_facts: false
  collections:
    - community.kubernetes
    - operator_sdk.util
  tasks:
    - import_role:
        name: krestomatio.k8s.v1alpha1.m4e.M4e

- name: moodle routines
  hosts: "{{ pods_ready_group }}:&{{ php_fpm_container_group }}"
  run_once: true
  gather_facts: false
  collections:
    - community.kubernetes
    - operator_sdk.util
  tasks:
    - name: include routines
      when: "php_fpm_state == 'present'"
      import_role:
        name: krestomatio.k8s.v1alpha1.m4e.M4e
        tasks_from: moodle-routines.yml
